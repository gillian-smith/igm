# @package _global_

hydra:
  run:
    dir: outputs

defaults:
  - /user/conf/inputs@inputs.init_state: init_state
  - override /inputs: 
    - init_state
  - override /processes: 
    - iceflow
  - override /outputs: 
    - write_ncdf

processes:
  iceflow:
    method: unified
    
    physics:
      energy_components: [viscosity, gravity, sliding]
      sliding:
        law: weertman
        weertman:
          exponent: 1.0
    unified:
      data_preparation:
        noise_type: none
        noise_scale: 0.0
        target_samples: 1
        batch_size: 16
        patch_size: 1000
        rotation_probability: 0.0
        flip_probability: 0.0
      network:
        architecture: FNO2
        pretrained: False
        print_summary: True
      bcs: [periodic_ns, periodic_we]
      optimizer: adam
      nbit_init: 10000
      adam:
        lr_init: 0.00002 #1.03
      halt:
        freq: 1
        success:
          - criterion: patience
            metric: cost
            patience:
              patience: 100
        failure:
          - criterion: nan
            metric: u
          - criterion: inf
            metric: u
      display:
        print_cost: True
    numerics:
      Nz: 4
      basis_vertical: lagrange
    emulator:
      network:
        nb_layers: 64
        nb_blocks: 4
        nb_out_filter: 32
        conv_ker_size: 7
        dropout_rate: 0

outputs:
  write_ncdf:
    output_file: results.nc
    vars_to_save: [topg, usurf, thk, velbar_mag, velsurf_mag, velbase_mag, slidingco]
